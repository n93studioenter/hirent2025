<div class="right_col" role="main" style="min-height: 668.8px;">
    <div  class="form-horizontal form-label-left">
        <div class="page-title">
            <div class="title_left">
                <h3>Quản lý thời gian hoạt động</h3>
            </div>
        </div>

        <div class="clearfix"></div>

        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12">
                <!-- Create new category -->
                <div class="x_panel">
                    <!-- add thông tin chung -->
                    <div class="x_content">
                        <br>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-2 col-sm-2 col-xs-12">Mã kho hàng</label>
                                <div class="col-md-10 col-sm-10 col-xs-12">
                                    <input name="whtid" type="hidden" id="whtid" value="0">
                                    <input name="whId" type="hidden" id="whId" value="@ViewBag.Wasehouse.whId">
                                    <input name="ctl00$ContentPlaceHolder1$txtIdware" type="hidden" id="ctl00_ContentPlaceHolder1_txtIdware" value="6">
                                    <input name="ctl00$ContentPlaceHolder1$txtKHohang" type="text" id="ctl00_ContentPlaceHolder1_txtKHohang" class="form-control col-md-7 col-xs-12" disabled="disabled" value="@ViewBag.Wasehouse.WarehouseCode">
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label col-md-2 col-sm-2 col-xs-12">Tên kho hàng</label>
                                <div class="col-md-10 col-sm-10 col-xs-12">
                                    <input name="ctl00$ContentPlaceHolder1$txtTenKHoHang" type="text" id="ctl00_ContentPlaceHolder1_txtTenKHoHang" class="form-control col-md-7 col-xs-12" disabled="disabled" value="@ViewBag.Wasehouse.WarehouseName">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-4 col-xs-12">

                            <div class="form-group">
                                <label class="control-label col-md-4 col-sm-4 col-xs-12">Ca 1:</label>
                                <div class="col-md-8 col-sm-8 col-xs-12" id="">
                                    <input type="text" class="form-control has-feedback-right" id="Title1" value="Buổi sáng">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-4 col-sm-4 col-xs-12">Giờ mở kho:</label>
                                <div class="col-md-8 col-sm-8 col-xs-12" id="idWhOpenTime">
                                    <input type="text" class="form-control has-feedback-right" id="whOpenTime" >
                                    <span class="fa fa-clock-o form-control-feedback right" aria-hidden="true"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-4 col-sm-4 col-xs-12">Giờ đóng kho:</label>
                                <div class="col-md-8 col-sm-8 col-xs-12" id="idWhCloseTime">
                                    <input type="text" class="form-control has-feedback-right" id="whCloseTime" >
                                    <span class="fa fa-clock-o form-control-feedback right" aria-hidden="true"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-4 col-sm-4 col-xs-12">Thứ</label>
                                <div class="col-md-8 col-sm-8 col-xs-12">
                                    <input type="number" id="txtTuThu" name="txtTuThu" class="form-control col-md-7 col-xs-12 hide">

                                    <table>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <span>
                                                        <a id="ac2" data-value="2" class="btn btn-info btn-xs fontCatNumber" onclick="activethu(2)">2</a>
                                                    </span>
                                                    <span>
                                                        <a id="ac3" data-value="3" class="btn btn-info btn-xs fontCatNumber" onclick="activethu(3)">3</a>
                                                    </span>
                                                    <span>
                                                        <a id="ac4" data-value="4" class="btn btn-info btn-xs fontCatNumber" onclick="activethu(4)">4</a>
                                                    </span>
                                                    <span>
                                                        <a id="ac5" data-value="5" class="btn btn-info btn-xs fontCatNumber" onclick="activethu(5)">5</a>
                                                    </span>
                                                    <span>
                                                        <a id="ac6" data-value="6" class="btn btn-info btn-xs fontCatNumber" onclick="activethu(6)">6</a>
                                                    </span>
                                                    <span> 
                                                        <a id="ac7" data-value="7" class="btn btn-info btn-xs fontCatNumber" onclick="activethu(7)">7</a>
                                                    </span>
                                                    <span> 
                                                        <a id="ac8" data-value="8" class="btn btn-info btn-xs fontCatNumber" onclick="activethu(8)">CN</a>
                                                    </span>

                                                </td>

                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4 col-sm-4 col-xs-12">

                            <div class="form-group">
                                <label class="control-label col-md-4 col-sm-4 col-xs-12">Ca 2:</label>
                                <div class="col-md-8 col-sm-8 col-xs-12" id="">
                                    <input type="text" class="form-control has-feedback-right" id="Title2" value="Buổi tối" >
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-4 col-sm-4 col-xs-12">Giờ mở 2:</label>
                                <div class="col-md-8 col-sm-8 col-xs-12" id="idWhOpenTime2">
                                    <input type="text" class="form-control has-feedback-right" id="WhOpenTime2" >
                                    <span class="fa fa-clock-o form-control-feedback right" aria-hidden="true"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-4 col-sm-4 col-xs-12">Giờ đóng 2 :</label>
                                <div class="col-md-8 col-sm-8 col-xs-12" id="idWhCloseTime2">
                                    <input type="text" class="form-control has-feedback-right" id="whCloseTime2" >
                                    <span class="fa fa-clock-o form-control-feedback right" aria-hidden="true"></span>
                                </div>
                            </div>
                            <div class="form-group hidden">
                                <label class="control-label col-md-4 col-sm-4 col-xs-12">Đến thứ</label>
                                <div class="col-md-8 col-sm-8 col-xs-12">
                                    <input type="number" id="txtDenThu" name="txtDenThu" class="form-control col-md-7 col-xs-12">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-4 col-xs-12">

                            <div class="form-group">
                                <label class="control-label col-md-4 col-sm-4 col-xs-12">Ca 3:</label>
                                <div class="col-md-8 col-sm-8 col-xs-12" id="">
                                    <input type="text" class="form-control has-feedback-right" id="Title3" value="Buổi chiều" >
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-4 col-sm-4 col-xs-12">Giờ mở 3:</label>
                                <div class="col-md-8 col-sm-8 col-xs-12" id="idWhOpenTime3">
                                    <input type="text" class="form-control has-feedback-right" id="whOpenTime3" >
                                    <span class="fa fa-clock-o form-control-feedback right" aria-hidden="true"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-4 col-sm-4 col-xs-12">Giờ đóng 3:</label>
                                <div class="col-md-8 col-sm-8 col-xs-12" id="idWhCloseTime3">
                                    <input type="text" class="form-control has-feedback-right" id="whCloseTime3" >
                                    <span class="fa fa-clock-o form-control-feedback right" aria-hidden="true"></span>
                                </div>
                            </div>

                        </div>
                        <div class="col-sm-12">
                        </div>


                        <div class="col-md-12 col-sm-12 col-xs-12" style="margin-top: 2%">
                            <div class="ln_solid"></div>

                            <div class="form-group">
                                <div class="col-md-6 col-sm-6 col-xs-12 col-md-offset-3">

                                    <input type="button" id="btnReset_Check" onclick="javascript: return btnReset_click();" class="btn btn-danger" value="RESET">
                                    <input type="button" id="btnSave_Check" onclick="javascript: return btnSave_click();" class="btn btn-success" value="Thêm" >
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="col-md-12 col-sm-12 col-xs-12">
                <!-- Table  -->
                <div class="x_panel">
                    <div class="x_title">
                        <h3>Ngày giờ hoạt động</h3>
                    </div>
                    <div class="x_content">
                        <div class="col-sm-12">
                            <table id="datatable" class="table table-striped table-bordered dataTable no-footer" role="grid" aria-describedby="datatable_info">
                                <thead>
                                    <tr role="row">
                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" style="width: 153.4px;" aria-label="Giờ mở kho: activate to sort column ascending">Giờ mở kho</th>
                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" style="width: 173.4px;" aria-label="Giờ đóng kho: activate to sort column ascending">Giờ đóng kho</th>
                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" style="width: 166.4px;" aria-label="Giờ mở kho2 : activate to sort column ascending">Giờ mở kho2 </th>
                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" style="width: 187.4px;" aria-label="Giờ đóng kho2: activate to sort column ascending">Giờ đóng kho2</th>

                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" style="width: 166.4px;" aria-label="Giờ mở kho3 : activate to sort column ascending">Giờ mở kho3 </th>
                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" style="width: 187.4px;" aria-label="Giờ đóng kho3: activate to sort column ascending">Giờ đóng kho3</th>
                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" style="width: 94.4px;" aria-label="Từ thứ: activate to sort column ascending">Thứ</th>
                                        <th class="sorting" tabindex="0" aria-controls="datatable" rowspan="1" colspan="1" style="width: 130.4px;" aria-label="
                                            Trang thái
                                        : activate to sort column ascending">
                                            Trang thái
                                        </th>
                                    </tr>
                                </thead>
                                <tbody class="tblWarehouse">
                                    @if (Model != null)
                                    {
                                        foreach (var item in (IEnumerable<HirentWeb2022.Models.tb_WareHouse_Time>)Model)
                                        {
                                            <tr>
                                                <td class="columnCenter">@item.whOpenTime</td>
                                                <td class="columnCenter">@item.whCloseTime</td>
                                                <td class="columnCenter">@item.whOpenTime2</td>
                                                <td class="columnCenter">@item.whCloseTime2</td>
                                                <td class="columnCenter">@item.whOpenTime3</td>
                                                <td class="columnCenter">@item.whCloseTime3</td>
                                                <td class="columnCenter">
                                                    @{
                                                        var getdate = item.FromDayOfWeek;
                                                        string result = getdate.Remove(getdate.Length - 1);
                                                        if (result != "8")
                                                        {
                                                            <span>@result</span>
                                                        }
else
                    {
                        <span>CN</span>
                    }
                                                    }


                                                </td>
                                                <td><a class="btn btn-danger btn-xs" style="font-size:11px;padding: 4px 5px;" onclick=" callDelete('@item.whtid')"><i class="fa fa-remove"></i>&nbsp; Xóa</a><a href="javascript:editware('@item.whtid')">Sửa</a></td>
                                            </tr>
                                        }
                                    }

                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="~/backend/build/jquery/dist/jquery.min.js"></script>
<link href="~/backend/css/bootstrap-datetimepicker.min.css" rel="stylesheet" />
<script src="~/backend/build/moment/min/moment.min.js"></script>
<script src="~/backend/js/bootstrap-datetimepicker.min.js"></script>
<script>

    function callDelete(id) {
        let text;
        if (confirm("Bạn có chắc muốn xóa!") == true) {
            var param = {
                "whtid": id,
            }
            $.ajax({
                url: '/Warehouse/WaseHouseTimeDelete',
                dataType: 'html',
                data: param,
                success: function (data, status, xhr) {
                    window.location.reload();
                },
                error: function (xhr, status, error) {
                    alert(status);
                }
            });
        }
        
    }
    function btnReset_click() {
        location.reload();
    }
    function editware(id) {
        $(".fontCatNumber").each(function () {
            $(this).removeClass("blackthu");
            $(this).removeClass("activethu");
        })
        $("#btnSave_Check").val("Cập nhật")
        var param = {
            "whtid": id
        }
        $.ajax({
            url: '/Warehouse/GetWasehouseTimeById',
            dataType: 'json',
            data: param,
            success: function (data, status, xhr) {
                $("#whtid").val(data.whtid);
                $("#whId").val(data.whId);
                $("#whOpenTime").val(data.whOpenTime);
                $("#WhOpenTime2").val(data.whOpenTime2);
                $("#whOpenTime3").val(data.whOpenTime3);
                $("#whCloseTime").val(data.whCloseTime);
                $("#whCloseTime2").val(data.whCloseTime2);
                $("#whCloseTime3").val(data.whCloseTime3);
                $("#Title1").val(data.Title1);
                $("#Title2").val(data.Title2);
                $("#Title3").val(data.Title3);
                //Giải phóng
                var getsplit = data.FromDayOfWeek.split(',');
                for (i = 0; i < getsplit.length; i++) {
                    if (getsplit[i] != "") {
                        $("#ac" + getsplit[i]).removeClass("blackthu");
                        $("#ac" + getsplit[i]).addClass("activethu");
                    }
                }
            },
            error: function (xhr, status, error) {
                alert(status);
            }
        });
    }
    function activethu(id) {
        if ($("#ac" + id).hasClass("activethu")) {
            $("#ac" + id).removeClass("activethu");
        }
        else {
            $("#ac" + id).addClass("activethu");
        }
    }
    $(document).ready(function () {
        $('#idWhOpenTime').datetimepicker({
            format: 'HH:mm',
            ignoreReadonly: true,
            showClose: true,
            allowInputToggle: true,
            disabledHours: [12,13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23], // Vô hiệu hóa giờ từ 13 đến 
        });
        $('#idWhOpenTime2').datetimepicker({
            format: 'HH:mm',
            ignoreReadonly: true,
            showClose: true,
            allowInputToggle: true,
            disabledHours: [0,1,2,3,4,5,6,7,8,9,10,11, 18, 19, 20, 21, 22, 23], // Vô hiệu hóa giờ từ 13 đến 

        });
        $('#idWhOpenTime3').datetimepicker({
            format: 'HH:mm',
            ignoreReadonly: true,
            showClose: true,
            allowInputToggle: true,
            disabledHours: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10,11,12, 13, 14, 15, 16, 17], // Vô hiệu hóa giờ từ 13 đến 

        });
        $('#whCloseTime').datetimepicker({
            format: 'HH:mm',
            ignoreReadonly: true,
            showClose: true,
            allowInputToggle: true,
            disabledHours: [12,13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23], // Vô hiệu hóa giờ từ 13 đến 

        });
        $('#whCloseTime2').datetimepicker({
            format: 'HH:mm',
            ignoreReadonly: true,
            showClose: true,
            allowInputToggle: true,
            disabledHours: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 18, 19, 20, 21, 22, 23], // Vô hiệu hóa giờ từ 13 đến 

        });
        $('#whCloseTime3').datetimepicker({
            format: 'HH:mm',
            ignoreReadonly: true,
            showClose: true,
            allowInputToggle: true,
            disabledHours: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17], // Vô hiệu hóa giờ từ 13 đến 

        });
        //$("#idWhOpenTime").on("dp.change", function (e) {
        //});

        var getsplit ='@ViewBag.Fromdate'.split(',');
        for (i = 0; i < getsplit.length; i++) {
            if (getsplit[i] != '') {
                $("#ac" + getsplit[i]).addClass("blackthu");
            }
        }

    });

    function btnSave_click() {
        if ($("#whOpenTime").val() == '') {
            alert("Vui lòng nhập thông tin!");
            $("#whOpenTime").focus();
            return false;
        }
        if ($("#whCloseTime").val() == '') {
            alert("Vui lòng nhập thông tin!");
            $("#whCloseTime").focus();
            return false;
        }
        var count = $(".activethu").length;
        if (count == 0) {
            alert("Vui lòng chọn ngày");
            return false;
        }
        var getdata = "";
        $(".activethu").each(function () {
            getdata += $(this).attr("data-value")+","; 
        });

        var param = {
            "whtid": $("#whtid").val(),
            "whId": $("#whId").val(),
            "Title1": $("#Title1").val(),
            "Title2": $("#Title2").val(),
            "Title3": $("#Title3").val(),
            "whOpenTime": $("#whOpenTime").val(),
            "whCloseTime": $("#whCloseTime").val(),
            "WhOpenTime2": $("#WhOpenTime2").val(),
            "whCloseTime2": $("#whCloseTime2").val(),
            "whOpenTime3": $("#whOpenTime3").val(),
            "whCloseTime3": $("#whCloseTime3").val(),
            "FromDayOfWeek": getdata,   
        }
        $.ajax({
            url: '/Warehouse/SaveData2',
            dataType: 'html',
            data: { "data": JSON.stringify(param) },
            success: function (data, status, xhr) {
                location.reload();
            },
            error: function (xhr, status, error) {
                alert(status);
            }
        });
    }
</script>